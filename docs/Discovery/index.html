<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Discovery operation · Couchbase Plugin</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="[Refresh Environment](#refresh-environment)"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Discovery operation · Couchbase Plugin"/><meta property="og:type" content="website"/><meta property="og:url" content="https://delphix.github.io/couchbase-plugin/"/><meta property="og:description" content="[Refresh Environment](#refresh-environment)"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/couchbase-plugin//img/logo.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/couchbase-plugin/js/scrollSpy.js"></script><link rel="stylesheet" href="/couchbase-plugin/css/main.css"/><script src="/couchbase-plugin/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/couchbase-plugin/"><img class="logo" src="/couchbase-plugin//img/logo2.png" alt="Couchbase Plugin"/><h2 class="headerTitleWithLogo">Couchbase Plugin</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/couchbase-plugin/docs/Overview" target="_self">Docs</a></li><li class=""><a href="/couchbase-plugin/help" target="_self">Help</a></li><li class=""><a href="https://github.com/delphix/couchbase-plugin" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Discovery</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/couchbase-plugin/docs/Overview">Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Installation<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/couchbase-plugin/docs/Installation">Installation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">PluginDevelopment<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/couchbase-plugin/docs/PluginDevelopment">Plugin Development</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Discovery<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem navListItemActive"><a class="navItem" href="/couchbase-plugin/docs/Discovery">Discovery operation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Linking<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/couchbase-plugin/docs/Linking">Linking Couchbase Data Source</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Provisioning<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/couchbase-plugin/docs/Provisioning">Provision VDB</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Discovery operation</h1></header><article><div><span><p><a href="#refresh-environment">Refresh Environment</a></p>
<p><a href="#create-sourceconfig">Create sourceconfig for XDCR setup</a></p>
<p><a href="#create-dsource">Create sourceconfig for cbbackupmgr setup</a></p>
<h1><a class="anchor" aria-hidden="true" id="purpose"></a><a href="#purpose" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Purpose</h1>
<p>Environment discovery is a process that enables the couchbase Plugin to determine couchbase installation details on a host. Database discovery is initiated during the environment set up process.  Whenver there is any changes (installing a new database home) to an already set up environment in the Delphix application, we need to perform environment refresh.</p>
<h1><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h1>
<ul>
<li><p>A source environment must be added to the Delphix Engine</p></li>
<li><p>Installation of the couchbase Plugin is required before the discovery</p></li>
<li><p>Environment variable <code>$COUCHBASE_PATH</code> should set on staging/target host, which contains binary path of couchbase</p></li>
</ul>
<h1><a class="anchor" aria-hidden="true" id="refresh-environment"></a><a href="#refresh-environment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refresh Environment</h1>
<p>Environment refresh will update the metadata associated with that environment and sends a new plugin to the host.</p>
<p>Steps:</p>
<ol>
<li>Login to the Delphix Management application.</li>
<li>Click Manage.</li>
<li>Select Environments.</li>
<li>In the Environments panel, click the name of the environment you want to refresh.</li>
<li>Select the Refresh icon.</li>
<li>In the Refresh confirmation dialog select Refresh.</li>
</ol>
<p><img src="/couchbase-plugin/img/image9.png" alt=""></p>
<h1><a class="anchor" aria-hidden="true" id="create-sourceconfig"></a><a href="#create-sourceconfig" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create Sourceconfig</h1>
<p>Environments exist to contain <code>repositories</code>, and each environment may have any number of repositories associated with it.
<code>Repository</code> contains database instances and in each repository any number of <code>SourceConfig</code> objects, which represent known database instances. There is no source config generated automatically in couchbase-plugin. Therefore, we need to add <code>SourceConfig</code> objects through which can create a dSource.</p>
<p><strong>XDCR setup:</strong></p>
<ol>
<li>Login to the Delphix Management application.</li>
<li>Click Manage.</li>
<li>Select Environments.</li>
<li>Select the repository</li>
<li>Click on <code>+</code> icon ( Shown in next image )</li>
</ol>
<p><img src="/couchbase-plugin/img/image10.png" alt=""></p>
<ol start="6">
<li>Add required details in <code>Add database</code> section.</li>
</ol>
<ul>
<li><code>Source Couchbase port</code>: Port number</li>
<li><code>Source Host</code>: Source host address</li>
<li><code>identity field</code>: Proivide unique name for staging database</li>
<li><code>DB data path</code>: Provide couchbase datapath available on your staging host</li>
</ul>
<p><img src="/couchbase-plugin/img/image11.png" alt=""></p>
<p><strong>CBBKPMGR setup:</strong></p>
<p>The steps to add source config remain same as we saw in XDCR setup. In this approach, we do not require any connection to source environment (zero touch production) and Delphix does not require details for source host.
We can enter any random or dummy value in this field of source host name when we choose Cbbackupmgr option for data ingestion.</p>
<ol>
<li>Login to the Delphix Management application.</li>
<li>Click Manage.</li>
<li>Select Environments.</li>
<li>Select the repository.</li>
<li>Click on <code>+</code> icon ( Shown in next image ).</li>
</ol>
<p><img src="/couchbase-plugin/img/image10.png" alt=""></p>
<ol start="6">
<li><ol start="6">
<li>Add required details in <code>Add database</code> section.</li>
</ol></li>
</ol>
<ul>
<li><code>Source Couchbase port</code>: Port number</li>
<li><code>Source Host</code>: Put dummy value for now</li>
<li><code>identity field</code>: Proivide unique name for staging database</li>
<li><code>DB data path</code>: Put dummy value for now</li>
</ul>
<p><img src="/couchbase-plugin/img/image11.png" alt=""></p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 6/19/2020</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/couchbase-plugin/docs/PluginDevelopment"><span class="arrow-prev">← </span><span>Plugin Development</span></a><a class="docs-next button" href="/couchbase-plugin/docs/Linking"><span>Linking Couchbase Data Source</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div></div></body></html>