{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"Overview \u00b6 Couchbase plugin is developed to virtualize Couchbase data source leveraging the following built-in couchbase technologies: Cross Data Center Replication (XDCR) allows data to be replicated across clusters that are potentially located in different data centers. Cbbackupmgr allows data to be restored on staging host of Couchbase Server. Ingesting Couchbase \u00b6 Couchbase cluster/single instance using (XDCR ingestion mechanism). Couchbase backup piece using (CBBACKUPMGR ingestion mechanism) - Zero Touch Production. Prerequisites \u00b6 Source Requirements: Couchbase database user with the following privileges: XDCR_ADMIN DATA_MONITOR Staging Requirements : O/S user with the following privileges: Regular o/s user. Execute access on couchbase binaries [ chmod -R 775 /opt/couchbase ]. Empty folder on host to hold delphix toolkit [ approximate 2GB free space ]. Empty folder on host to mount nfs filesystem. This is just an empty folder with no space requirements and acts as a base folder for NFS mounts. sudo privileges for mount and umount. See sample below assuming delphix_os is used as delphix user. shell Defaults:delphixos !requiretty delphixos ALL=NOPASSWD: \\ /bin/mount, /bin/umount Customers who intend to use CBBACKUPMGR (Couchbase backup manager ingestion) must follow the instructions to avoid source/production server dependency. Provide all source server buckets related information (using the command below) in a file and place where <Toolkit-Directory-Path>/couchbase_src_bucket_info.cfg : /opt/couchbase/bin/couchbase-cli bucket-list --cluster <sourcehost>:8091 --username $username --password $password Create config file using the following command. This file will be required at the time of dSource creation using CBBACKUPMGR. /opt/couchbase/bin/cbbackupmgr config --archive /u01/couchbase_backup --repo delphix Get data from source host in backup directory of staging host /opt/couchbase/bin/cbbackupmgr backup -a /u01/couchbase_backup -r delphix -c couchbase://<hostname> -u user -p password Target Requirements : O/S user with the following privileges: Regular o/s user. Execute access on couchbase binaries [ chmod -R 775 /opt/couchbase ] . Empty folder on host to hold Delphix toolkit [ approximate 2GB free space ] . Empty folder on host to mount nfs filesystem. This is just an empty folder with no space requirements and act as a base folder for NFS mounts. sudo privileges for mount and umount. See sample below assuming delphix_os is used as delphix user. Defaults:delphixos !requiretty delphixos ALL=NOPASSWD: /bin/mount, /bin/umount","title":"Overview"},{"location":"index.html#overview","text":"Couchbase plugin is developed to virtualize Couchbase data source leveraging the following built-in couchbase technologies: Cross Data Center Replication (XDCR) allows data to be replicated across clusters that are potentially located in different data centers. Cbbackupmgr allows data to be restored on staging host of Couchbase Server.","title":"Overview"},{"location":"index.html#ingesting-couchbase","text":"Couchbase cluster/single instance using (XDCR ingestion mechanism). Couchbase backup piece using (CBBACKUPMGR ingestion mechanism) - Zero Touch Production.","title":"Ingesting Couchbase"},{"location":"index.html#prerequisites","text":"Source Requirements: Couchbase database user with the following privileges: XDCR_ADMIN DATA_MONITOR Staging Requirements : O/S user with the following privileges: Regular o/s user. Execute access on couchbase binaries [ chmod -R 775 /opt/couchbase ]. Empty folder on host to hold delphix toolkit [ approximate 2GB free space ]. Empty folder on host to mount nfs filesystem. This is just an empty folder with no space requirements and acts as a base folder for NFS mounts. sudo privileges for mount and umount. See sample below assuming delphix_os is used as delphix user. shell Defaults:delphixos !requiretty delphixos ALL=NOPASSWD: \\ /bin/mount, /bin/umount Customers who intend to use CBBACKUPMGR (Couchbase backup manager ingestion) must follow the instructions to avoid source/production server dependency. Provide all source server buckets related information (using the command below) in a file and place where <Toolkit-Directory-Path>/couchbase_src_bucket_info.cfg : /opt/couchbase/bin/couchbase-cli bucket-list --cluster <sourcehost>:8091 --username $username --password $password Create config file using the following command. This file will be required at the time of dSource creation using CBBACKUPMGR. /opt/couchbase/bin/cbbackupmgr config --archive /u01/couchbase_backup --repo delphix Get data from source host in backup directory of staging host /opt/couchbase/bin/cbbackupmgr backup -a /u01/couchbase_backup -r delphix -c couchbase://<hostname> -u user -p password Target Requirements : O/S user with the following privileges: Regular o/s user. Execute access on couchbase binaries [ chmod -R 775 /opt/couchbase ] . Empty folder on host to hold Delphix toolkit [ approximate 2GB free space ] . Empty folder on host to mount nfs filesystem. This is just an empty folder with no space requirements and act as a base folder for NFS mounts. sudo privileges for mount and umount. See sample below assuming delphix_os is used as delphix user. Defaults:delphixos !requiretty delphixos ALL=NOPASSWD: /bin/mount, /bin/umount","title":"Prerequisites"},{"location":"Discovery.html","text":"Discovery \u00b6 Environment discovery is a process that enables the Couchbase Plugin to determine Couchbase installation details on a host. Database discovery is initiated during the environment set up process . Whenever there is any change (installing a new database home) to an already set up environment in the Delphix application, we need to perform an environment refresh. Prerequisites \u00b6 A source environment must be added to the Delphix Engine. Installation of the Couchbase Plugin is required before the Discovery. Environment variable $COUCHBASE_PATH should set on staging/target host, which contains the binary path of Couchbase. Refreshing an Environment \u00b6 Environment refresh will update the metadata associated with that environment and send a new Plugin to the host. Login to the Delphix Management application. Click Manage . Select Environments . In the Environments panel, click the name of the environment you want to refresh. Select the Refresh icon. In the Refresh confirmation dialog select Refresh . XDCR Setup \u00b6 Environments exist to contain repositories , and each environment may have any number of repositories associated with it. Repository contains database instances and in each repository any number of SourceConfig objects, which represent known database instances. Source config is not generated automatically in Couchbase plugin. Therefore, we need to add SourceConfig object through which can create a dSource. Login to the Delphix Management application. Click Manage . Select Environments . Select the repository. Click on + icon (Shown in next image). Add required details in the Add database section. Enter port number in Source Couchbase port section. Enter source host address in section Source Host . Enter unique name for the staging database in identify field section. Enter Couchbase data path of staging host in DB data path section. CBBACKUPMGR Setup \u00b6 The steps to add source config remain the same as we saw in XDCR setup. In this approach, we don't connect to source environment as this is zero-touch production approach. We can enter any random or dummy value in this field of source host name when we choose CBBACKUPMGR option for data ingestion. Login to the Delphix Management application. Click Manage . Select Environments . Select the repository. Click on + icon (Shown in next image). In the Add Database section enter the following information: Source Couchbase port : This is the port number to be used by Couchbase services. Source Host : Leave this field as blank. identity field : Provide unique name for staging database. DB data path : Leave this field as blank.","title":"Discovery"},{"location":"Discovery.html#discovery","text":"Environment discovery is a process that enables the Couchbase Plugin to determine Couchbase installation details on a host. Database discovery is initiated during the environment set up process . Whenever there is any change (installing a new database home) to an already set up environment in the Delphix application, we need to perform an environment refresh.","title":"Discovery"},{"location":"Discovery.html#prerequisites","text":"A source environment must be added to the Delphix Engine. Installation of the Couchbase Plugin is required before the Discovery. Environment variable $COUCHBASE_PATH should set on staging/target host, which contains the binary path of Couchbase.","title":"Prerequisites"},{"location":"Discovery.html#refreshing-an-environment","text":"Environment refresh will update the metadata associated with that environment and send a new Plugin to the host. Login to the Delphix Management application. Click Manage . Select Environments . In the Environments panel, click the name of the environment you want to refresh. Select the Refresh icon. In the Refresh confirmation dialog select Refresh .","title":"Refreshing an Environment"},{"location":"Discovery.html#xdcr-setup","text":"Environments exist to contain repositories , and each environment may have any number of repositories associated with it. Repository contains database instances and in each repository any number of SourceConfig objects, which represent known database instances. Source config is not generated automatically in Couchbase plugin. Therefore, we need to add SourceConfig object through which can create a dSource. Login to the Delphix Management application. Click Manage . Select Environments . Select the repository. Click on + icon (Shown in next image). Add required details in the Add database section. Enter port number in Source Couchbase port section. Enter source host address in section Source Host . Enter unique name for the staging database in identify field section. Enter Couchbase data path of staging host in DB data path section.","title":"XDCR Setup"},{"location":"Discovery.html#cbbackupmgr-setup","text":"The steps to add source config remain the same as we saw in XDCR setup. In this approach, we don't connect to source environment as this is zero-touch production approach. We can enter any random or dummy value in this field of source host name when we choose CBBACKUPMGR option for data ingestion. Login to the Delphix Management application. Click Manage . Select Environments . Select the repository. Click on + icon (Shown in next image). In the Add Database section enter the following information: Source Couchbase port : This is the port number to be used by Couchbase services. Source Host : Leave this field as blank. identity field : Provide unique name for staging database. DB data path : Leave this field as blank.","title":"CBBACKUPMGR Setup"},{"location":"Installation.html","text":"Plugin Installation \u00b6 Prerequisites \u00b6 Install Delphix Engine of version 5.3.x. Install Couchbase binaries on source, staging, and target servers Installing the Couchbase Plugin \u00b6 Method1: Using GUI \u00b6 Click on Manage (present on top-left of this page) and then Plugins . Click on + icon. Click on Upload a plugin. Select the build(artifacts.json) from your device. Click on close button. See the plugin version in Plugins section. Method2: Using dvp command \u00b6 dvp upload -e <Delphix_Engine_Name> -u <username> --password <password> Delphix Engine's documentation on installing plugins: PluginManagement .","title":"Installation"},{"location":"Installation.html#plugin-installation","text":"","title":"Plugin Installation"},{"location":"Installation.html#prerequisites","text":"Install Delphix Engine of version 5.3.x. Install Couchbase binaries on source, staging, and target servers","title":"Prerequisites"},{"location":"Installation.html#installing-the-couchbase-plugin","text":"","title":"Installing the Couchbase Plugin"},{"location":"Installation.html#method1-using-gui","text":"Click on Manage (present on top-left of this page) and then Plugins . Click on + icon. Click on Upload a plugin. Select the build(artifacts.json) from your device. Click on close button. See the plugin version in Plugins section.","title":"Method1: Using GUI"},{"location":"Installation.html#method2-using-dvp-command","text":"dvp upload -e <Delphix_Engine_Name> -u <username> --password <password> Delphix Engine's documentation on installing plugins: PluginManagement .","title":"Method2: Using dvp command"},{"location":"Linking.html","text":"Linking \u00b6 Linking a data source will create a dSource object on the engine and allow Delphix to ingest data from this source. The dSource is an object that the Delphix Virtualization Engine uses to create and update virtual copies of your database. Prerequisites \u00b6 Discovery and source config object should be created on the staging host before proceeding to link Couchbase dataset. Creating dSource \u00b6 Login to Delphix Management application. Click Manage > Datasets . Select Add dSource . In the Add dSource wizard, select the Couchbase source configuration which is created on the staging host. Enter the Couchbase-specific parameters for your dSource configuration. Select the dSource approach from the drop-down (XDCR and Couchbase Backup Manager) available on dSource wizard. Based on approach selection, follow the steps either for XDCR or Couchbase Backup Manager method. The Description of both methods is below. Method1: XDCR \u00b6 Cross datacenter replication allows data to be replicated across clusters that are potentially located in different data centers. Enter the details for Staging Couchbase host - FQDN or IP address recommended. Enter the details for Staging Port Number available on the staging host. The default port for couchbase is 8091. Enter the details for Mount Path available on the staging host. This empty folder acts as a base for NFS mounts. Enter the details for Staging Cluster Name to setup new cluster on the staging host. Enter the configuration details for your staging cluster as per resource availability on the staging host. Cluster RAM Size Cluster Index RAM Size Cluster FTS RAM Size Cluster Eventing RAM Size Cluster Analysis RAM Size Click on + plus symbol to modify configuration settings. Mention bucket list for which cross datacenter replication (XDCR) only be enabled. Enter the details of Bucket Name to be part of XDCR. Then click on Next button Provide the details for dSource Name and Target group on the dSource configuration page. On the Data management page, select the following: Staging Environment: This will be your staging host where source config was created. User: Database OS user with required privileges for linking the dataset. On the next section, review the configuration and click on Next button to view the summary. Click the Submit button which will initiate the linking process. Once dSource is created successfully, you can review the datasets on Manage > Datasets > dSource Name . Method2: Couchbase Backup Manager \u00b6 Note : Follow the instructions below before creating dSource to avoid source/production server dependency. Provide source server buckets related information in a file: /tmp/couchbase_src_bucket_info.cfg . /opt/couchbase/bin/couchbase-cli bucket-list --cluster <sourcehost>:8091 --username $username --password $password Backup Repository : This file will be required at the time of dSource creation using CBBACKUPMGR. /opt/couchbase/bin/cbbackupmgr config --archive /u01/couchbase_backup --repo delphix Backup Location : Get data from source host in backup directory of staging host. /opt/couchbase/bin/cbbackupmgr backup -a /u01/couchbase_backup -r delphix -c couchbase://<hostname> -u user -p password Procedure : Login to Delphix Management application. Click Manage > Datasets . Select Add dSource . In the Add dSource wizard , select the Couchbase source configuration you created on the staging host. Enter the Couchbase-specific parameters for your dSource configuration. Select the dSource type from the drop-down available on dSource wizard. When we select CBBACKUPMGR as dSource Type, the following fields on dSource wizard are mandatory. Enter the details for Backup Location where the backup files generated through CBBACKUPMGR are present on the staging host. Enter the details for Backup Repository that contains a backup configuration of staging host. The remaining steps for CBBACKUPMGR ingestion are similar to XDCR. Use steps from the second point mentioned in XDCR method. Note: When we select dSource type as Couchbase Backup Manager, we do not require any details for the Staging Couchbase Host field.","title":"Linking"},{"location":"Linking.html#linking","text":"Linking a data source will create a dSource object on the engine and allow Delphix to ingest data from this source. The dSource is an object that the Delphix Virtualization Engine uses to create and update virtual copies of your database.","title":"Linking"},{"location":"Linking.html#prerequisites","text":"Discovery and source config object should be created on the staging host before proceeding to link Couchbase dataset.","title":"Prerequisites"},{"location":"Linking.html#creating-dsource","text":"Login to Delphix Management application. Click Manage > Datasets . Select Add dSource . In the Add dSource wizard, select the Couchbase source configuration which is created on the staging host. Enter the Couchbase-specific parameters for your dSource configuration. Select the dSource approach from the drop-down (XDCR and Couchbase Backup Manager) available on dSource wizard. Based on approach selection, follow the steps either for XDCR or Couchbase Backup Manager method. The Description of both methods is below.","title":"Creating dSource"},{"location":"Linking.html#method1-xdcr","text":"Cross datacenter replication allows data to be replicated across clusters that are potentially located in different data centers. Enter the details for Staging Couchbase host - FQDN or IP address recommended. Enter the details for Staging Port Number available on the staging host. The default port for couchbase is 8091. Enter the details for Mount Path available on the staging host. This empty folder acts as a base for NFS mounts. Enter the details for Staging Cluster Name to setup new cluster on the staging host. Enter the configuration details for your staging cluster as per resource availability on the staging host. Cluster RAM Size Cluster Index RAM Size Cluster FTS RAM Size Cluster Eventing RAM Size Cluster Analysis RAM Size Click on + plus symbol to modify configuration settings. Mention bucket list for which cross datacenter replication (XDCR) only be enabled. Enter the details of Bucket Name to be part of XDCR. Then click on Next button Provide the details for dSource Name and Target group on the dSource configuration page. On the Data management page, select the following: Staging Environment: This will be your staging host where source config was created. User: Database OS user with required privileges for linking the dataset. On the next section, review the configuration and click on Next button to view the summary. Click the Submit button which will initiate the linking process. Once dSource is created successfully, you can review the datasets on Manage > Datasets > dSource Name .","title":"Method1: XDCR"},{"location":"Linking.html#method2-couchbase-backup-manager","text":"Note : Follow the instructions below before creating dSource to avoid source/production server dependency. Provide source server buckets related information in a file: /tmp/couchbase_src_bucket_info.cfg . /opt/couchbase/bin/couchbase-cli bucket-list --cluster <sourcehost>:8091 --username $username --password $password Backup Repository : This file will be required at the time of dSource creation using CBBACKUPMGR. /opt/couchbase/bin/cbbackupmgr config --archive /u01/couchbase_backup --repo delphix Backup Location : Get data from source host in backup directory of staging host. /opt/couchbase/bin/cbbackupmgr backup -a /u01/couchbase_backup -r delphix -c couchbase://<hostname> -u user -p password Procedure : Login to Delphix Management application. Click Manage > Datasets . Select Add dSource . In the Add dSource wizard , select the Couchbase source configuration you created on the staging host. Enter the Couchbase-specific parameters for your dSource configuration. Select the dSource type from the drop-down available on dSource wizard. When we select CBBACKUPMGR as dSource Type, the following fields on dSource wizard are mandatory. Enter the details for Backup Location where the backup files generated through CBBACKUPMGR are present on the staging host. Enter the details for Backup Repository that contains a backup configuration of staging host. The remaining steps for CBBACKUPMGR ingestion are similar to XDCR. Use steps from the second point mentioned in XDCR method. Note: When we select dSource type as Couchbase Backup Manager, we do not require any details for the Staging Couchbase Host field.","title":"Method2: Couchbase Backup Manager"},{"location":"PluginDevelopment.html","text":"Building a Plugin \u00b6 Create a virtual environment and use the following script to install the required libraries (pytest, pytest-html, and pytest-cov): i) cd /Users/<your-user-name>/Desktop/Plugins/OpenSourceCouchbase/couchbase-plugin ii) ./test/virtualEnvSetup.sh \"MyLocalEnv\" Run this command to activate the virtual environment created in step 1. . test/MyLocalEnv/bin/activate Build the source code. It generates the build with name artifact.json : dvp build Uploading a Plugin \u00b6 Upload the artifact.json (generated in step 3) on Delphix Engine: dvp upload -e <Delphix_Engine_Name> -u <username> --password <password> Unit Test \u00b6 Unit test run: Make sure to build the source code (using dvp build ) before running unit tests. Execute below command to run unit tests: pytest test/ . Summary Report \u00b6 A report with the name Report.html gets generated in the test directory which contains the summary of test passed vs failed. If any test case fails then a complete stack trace can be seen in that test case section. Module wise coverage report \u00b6 There is a report folder CodeCoverage (can change the folder name in config file pytest.ini ) generated in test directory, which contains html files. These files help in source code coverage visualization, in which we can see statements processed and missed in each module of source code. Debugging Plugin Logs \u00b6 Download the Plugin logs using the following command: dvp download-logs -c plugin_config.yml -e <Delphix_Engine_Name> -u admin --password <password>","title":"Plugin Development"},{"location":"PluginDevelopment.html#building-a-plugin","text":"Create a virtual environment and use the following script to install the required libraries (pytest, pytest-html, and pytest-cov): i) cd /Users/<your-user-name>/Desktop/Plugins/OpenSourceCouchbase/couchbase-plugin ii) ./test/virtualEnvSetup.sh \"MyLocalEnv\" Run this command to activate the virtual environment created in step 1. . test/MyLocalEnv/bin/activate Build the source code. It generates the build with name artifact.json : dvp build","title":"Building a Plugin"},{"location":"PluginDevelopment.html#uploading-a-plugin","text":"Upload the artifact.json (generated in step 3) on Delphix Engine: dvp upload -e <Delphix_Engine_Name> -u <username> --password <password>","title":"Uploading a Plugin"},{"location":"PluginDevelopment.html#unit-test","text":"Unit test run: Make sure to build the source code (using dvp build ) before running unit tests. Execute below command to run unit tests: pytest test/ .","title":"Unit Test"},{"location":"PluginDevelopment.html#summary-report","text":"A report with the name Report.html gets generated in the test directory which contains the summary of test passed vs failed. If any test case fails then a complete stack trace can be seen in that test case section.","title":"Summary Report"},{"location":"PluginDevelopment.html#module-wise-coverage-report","text":"There is a report folder CodeCoverage (can change the folder name in config file pytest.ini ) generated in test directory, which contains html files. These files help in source code coverage visualization, in which we can see statements processed and missed in each module of source code.","title":"Module wise coverage report"},{"location":"PluginDevelopment.html#debugging-plugin-logs","text":"Download the Plugin logs using the following command: dvp download-logs -c plugin_config.yml -e <Delphix_Engine_Name> -u admin --password <password>","title":"Debugging Plugin Logs"},{"location":"Provisioning.html","text":"Provisioning \u00b6 Virtual databases are a virtualized copies of dSource. Prerequisites \u00b6 Required a linked dSource from a source host. Added compatible target environment on Delphix Engine. Provisioning a VDB \u00b6 Click on the icon highlighted in red color. Select the target host from the dropdown on which VDB needs to be created. Enter the following values for the target configuration: Target Port Number : Port number on which Couchbase services will be started. Mount Path : NFS mount path where dSource snapshot will be mounted by Engine. Target Cluster name : Cluster name which is required to be set up on the target host. Cluster Ram Size Cluster Index Ram Size Cluster FTS Ram Size Cluster Eventing Ram Size Cluster Analytics Ram Size Target couchbase Admin User Target couchbase Admin password Provision vFiles: Add VDB name and target group. No need to add Policies, select Next . No need to add Masking, select Next . No need to add Hooks, select Next . Preview the summary and select Submit . Once the VDB is created successfully, you can review the datasets on Manage > Datasets > vdb Name .","title":"Provisioning"},{"location":"Provisioning.html#provisioning","text":"Virtual databases are a virtualized copies of dSource.","title":"Provisioning"},{"location":"Provisioning.html#prerequisites","text":"Required a linked dSource from a source host. Added compatible target environment on Delphix Engine.","title":"Prerequisites"},{"location":"Provisioning.html#provisioning-a-vdb","text":"Click on the icon highlighted in red color. Select the target host from the dropdown on which VDB needs to be created. Enter the following values for the target configuration: Target Port Number : Port number on which Couchbase services will be started. Mount Path : NFS mount path where dSource snapshot will be mounted by Engine. Target Cluster name : Cluster name which is required to be set up on the target host. Cluster Ram Size Cluster Index Ram Size Cluster FTS Ram Size Cluster Eventing Ram Size Cluster Analytics Ram Size Target couchbase Admin User Target couchbase Admin password Provision vFiles: Add VDB name and target group. No need to add Policies, select Next . No need to add Masking, select Next . No need to add Hooks, select Next . Preview the summary and select Submit . Once the VDB is created successfully, you can review the datasets on Manage > Datasets > vdb Name .","title":"Provisioning a VDB"}]}